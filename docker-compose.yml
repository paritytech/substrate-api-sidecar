version: "3.8"
services:
  avail:
    container_name: avail-node
    image: availj/avail:latest
    volumes:
      - ./avail-data:/data
    ports:
      - "30333:30333"  # P2P port
      - "9944:9944"    # WS-RPC port (optional, internal access only)
    command: >
      --chain ${NETWORK:-turing}
      --name ${NODE_NAME:-my-avail-node}
      --base-path /data
      --unsafe-rpc-external
      --rpc-cors=all
      --pruning archive
    restart: unless-stopped

  sidecar:
    image: availj/sidecar-api:${NETWORK:-testnet}
    read_only: true
    ports:
      - "8080:8080"
    environment:
      SAS_SUBSTRATE_URL: ws://avail-node:9944
      SAS_EXPRESS_PORT: 8080
    depends_on:
      - avail
    restart: unless-stopped
